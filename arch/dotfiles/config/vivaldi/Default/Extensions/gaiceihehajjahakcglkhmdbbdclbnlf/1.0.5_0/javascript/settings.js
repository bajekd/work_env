const reg=/^[\r\t\f\v ]+|[\r\t\f\v ]+$/gm;let defaultOptions={speed:1,displayKeyCode:86,rememberSpeed:!1,audioBoolean:!1,startHidden:!1,forceLastSavedSpeed:!1,enabled:!0,controllerOpacity:.3,keyBindings:[{action:"display",key:86,value:0,force:!1,predefined:!0},{action:"slower",key:83,value:.1,force:!1,predefined:!0},{action:"faster",key:68,value:.1,force:!1,predefined:!0},{action:"rewind",key:90,value:10,force:!1,predefined:!0},{action:"advance",key:88,value:10,force:!1,predefined:!0},{action:"reset",key:82,value:1,force:!1,predefined:!0},{action:"fast",key:71,value:1.8,force:!1,predefined:!0}],blacklist:"www.instagram.com\n    twitter.com\n    imgur.com\n    teams.microsoft.com\n  ".replace(reg,"")},keyBindings=[],keyCodeAliases={0:"null",null:"null",undefined:"null",32:"Space",37:"Left",38:"Up",39:"Right",40:"Down",96:"Num 0",97:"Num 1",98:"Num 2",99:"Num 3",100:"Num 4",101:"Num 5",102:"Num 6",103:"Num 7",104:"Num 8",105:"Num 9",106:"Num *",107:"Num +",109:"Num -",110:"Num .",111:"Num /",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",186:";",188:"<",189:"-",187:"+",190:">",191:"/",192:"~",219:"[",220:"\\",221:"]",222:"'"};function recordKeyPress(e){e.keyCode>=48&&e.keyCode<=57||e.keyCode>=65&&e.keyCode<=90||keyCodeAliases[e.keyCode]?(e.target.value=keyCodeAliases[e.keyCode]||String.fromCharCode(e.keyCode),e.target.keyCode=e.keyCode,e.preventDefault(),e.stopPropagation()):8===e.keyCode?e.target.value="":27===e.keyCode&&(e.target.value="null",e.target.keyCode=null)}function inputFilterNumbersOnly(e){var t=String.fromCharCode(e.keyCode);/[\d\.]$/.test(t)&&/^\d+(\.\d*)?$/.test(e.target.value+t)||(e.preventDefault(),e.stopPropagation())}function inputFocus(e){e.target.value=""}function inputBlur(e){e.target.value=keyCodeAliases[e.target.keyCode]||String.fromCharCode(e.target.keyCode)}function updateShortcutInputText(e,t){document.getElementById(e).value=keyCodeAliases[t]||String.fromCharCode(t),document.getElementById(e).keyCode=t}function updateCustomShortcutInputText(e,t){e.value=keyCodeAliases[t]||String.fromCharCode(t),e.keyCode=t}var customActionsNoValues=["pause","muted","mark","jump","display"];function createShortcut(){var e=document.createElement("div");e.setAttribute("class","row customs"),e.innerHTML='<select class="customDo">\n    <option value="slower">Decrease speed</option>\n    <option value="faster">Increase speed</option>\n    <option value="rewind">Rewind</option>\n    <option value="advance">Advance</option>\n    <option value="reset">Reset speed</option>\n    <option value="fast">Preferred speed</option>\n    <option value="muted">Mute</option>\n    <option value="pause">Pause</option>\n    <option value="mark">Set marker</option>\n    <option value="jump">Jump to marker</option>\n    <option value="display">Show/hide controller</option>\n    </select>\n    <input class="customKey" type="text" placeholder="press a key"/>\n    <input class="customValue" type="text" placeholder="value (0.10)"/>\n    <select class="customForce">\n    <option value="false">Do not disable website key bindings</option>\n    <option value="true">Disable website key bindings</option>\n    </select>\n    <button class="removeParent">X</button>';var t=document.getElementById("customs");t.insertBefore(e,t.children[t.childElementCount-1])}function createKeyBindings(e){let t=e.querySelector(".customDo").value,o=e.querySelector(".customKey").keyCode,n=Number(e.querySelector(".customValue").value),a=e.querySelector(".customForce").value,d=!!e.id;keyBindings.push({action:t,key:o,value:n,force:a,predefined:d})}function validate(){var e=!0,t=document.getElementById("status");return document.getElementById("blacklist").value.split("\n").forEach((o=>{if((o=o.replace(reg,"")).startsWith("/"))try{var n=o.split("/");if(n.length<3)throw"invalid regex";var a=n.pop(),d=n.slice(1).join("/");RegExp(d,a)}catch(n){return t.textContent='Error: Invalid blacklist regex: "'+o+'". Unable to save. Try wrapping it in foward slashes.',void(e=!1)}})),e}function save_options(){if(!1!==validate()){keyBindings=[],Array.from(document.querySelectorAll(".customs")).forEach((e=>createKeyBindings(e)));var e=document.getElementById("rememberSpeed").checked,t=document.getElementById("forceLastSavedSpeed").checked,o=document.getElementById("audioBoolean").checked,n=document.getElementById("enabled").checked,a=document.getElementById("startHidden").checked,d=document.getElementById("controllerOpacity").value,r=document.getElementById("blacklist").value;chrome.storage.sync.remove(["resetSpeed","speedStep","fastSpeed","rewindTime","advanceTime","resetKeyCode","slowerKeyCode","fasterKeyCode","rewindKeyCode","advanceKeyCode","fastKeyCode"]),chrome.storage.sync.set({rememberSpeed:e,forceLastSavedSpeed:t,audioBoolean:o,enabled:n,startHidden:a,controllerOpacity:d,keyBindings:keyBindings,blacklist:r.replace(reg,"")},(function(){var e=document.getElementById("status");e.textContent="Options saved",setTimeout((function(){e.textContent=""}),1e3)}))}}function restore_options(){chrome.storage.sync.get(defaultOptions,(function(e){for(let o in document.getElementById("rememberSpeed").checked=e.rememberSpeed,document.getElementById("forceLastSavedSpeed").checked=e.forceLastSavedSpeed,document.getElementById("audioBoolean").checked=e.audioBoolean,document.getElementById("enabled").checked=e.enabled,document.getElementById("startHidden").checked=e.startHidden,document.getElementById("controllerOpacity").value=e.controllerOpacity,document.getElementById("blacklist").value=e.blacklist,0==e.keyBindings.filter((e=>"display"==e.action)).length&&e.keyBindings.push({action:"display",value:0,force:!1,predefined:!0}),e.keyBindings){var t=e.keyBindings[o];if(t.predefined)"display"==t.action&&void 0===t.key&&(t.key=e.displayKeyCode||defaultOptions.displayKeyCode),customActionsNoValues.includes(t.action)&&(document.querySelector("#"+t.action+" .customValue").disabled=!0),updateCustomShortcutInputText(document.querySelector("#"+t.action+" .customKey"),t.key),document.querySelector("#"+t.action+" .customValue").value=t.value,document.querySelector("#"+t.action+" .customForce").value=t.force;else{createShortcut();let e=document.querySelector(".customs:last-of-type");e.querySelector(".customDo").value=t.action,customActionsNoValues.includes(t.action)&&(e.querySelector(".customValue").disabled=!0),updateCustomShortcutInputText(e.querySelector(".customKey"),t.key),e.querySelector(".customValue").value=t.value,e.querySelector(".customForce").value=t.force}}}))}function restore_defaults(){chrome.storage.sync.set(defaultOptions,(function(){restore_options(),document.querySelectorAll(".removeParent").forEach((e=>e.click()));var e=document.getElementById("status");e.textContent="Default options restored",setTimeout((function(){e.textContent=""}),1e3)}))}function show_experimental(){document.querySelectorAll(".customForce").forEach((e=>e.style.display="inline-block"))}document.addEventListener("DOMContentLoaded",(function(){function e(e,t,o){e.target.classList.contains(t)&&o(e)}restore_options(),document.getElementById("save").addEventListener("click",save_options),document.getElementById("add").addEventListener("click",createShortcut),document.getElementById("restore").addEventListener("click",restore_defaults),document.getElementById("experimental").addEventListener("click",show_experimental),document.addEventListener("keypress",(t=>{e(t,"customValue",inputFilterNumbersOnly)})),document.addEventListener("focus",(t=>{e(t,"customKey",inputFocus)})),document.addEventListener("blur",(t=>{e(t,"customKey",inputBlur)})),document.addEventListener("keydown",(t=>{e(t,"customKey",recordKeyPress)})),document.addEventListener("click",(t=>{e(t,"removeParent",(function(){t.target.parentNode.remove()}))})),document.addEventListener("change",(t=>{e(t,"customDo",(function(){customActionsNoValues.includes(t.target.value)?(t.target.nextElementSibling.nextElementSibling.disabled=!0,t.target.nextElementSibling.nextElementSibling.value=0):t.target.nextElementSibling.nextElementSibling.disabled=!1}))}))}));